<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Checkout - FavFood</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="css/icon.css" />
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: "#05113b",
            },
          },
        },
      };
    </script>
  </head>
  <body class="bg-gray-50">
    <!-- Header -->
    <header class="bg-white shadow-md sticky top-0 z-50">
      <div
        class="container mx-auto px-4 py-4 flex items-center justify-between relative"
      >
        <a
          href="index.html"
          class="text-sm text-primary hover:underline flex items-center space-x-1"
        >
          <i class="fas fa-arrow-left text-lg"></i>
        </a>

        <p
          class="absolute left-1/2 -translate-x-1/2 font-bold text-lg text-primary"
        >
          Pesanan
        </p>
      </div>
    </header>

    <!-- Content -->
    <main class="container mx-auto px-4 py-8">
      <h2 class="text-2xl md:text-3xl font-bold text-primary mb-6">
        Detail Pesanan
      </h2>

      <div id="empty-state" class="hidden">
        <div
          class="bg-white rounded-lg shadow-md p-6 flex flex-col items-center text-center"
        >
          <i class="fas fa-shopping-cart text-4xl text-gray-300 mb-4"></i>
          <p class="text-gray-600 mb-4">Belum ada pesanan di keranjang Anda.</p>
          <a
            href="index.html"
            class="bg-primary text-white px-4 py-2 rounded-lg text-sm font-semibold hover:bg-opacity-90 transition"
          >
            Kembali ke Menu
          </a>
        </div>
      </div>

      <div id="order-detail" class="space-y-6 hidden">
        <!-- Ringkasan Item -->
        <div class="bg-white rounded-lg shadow-md p-4 md:p-6">
          <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-semibold text-gray-800">Pesanan Anda</h3>
            <span id="order-count" class="text-sm text-gray-500"></span>
          </div>

          <div id="order-items" class="divide-y divide-gray-200"></div>
        </div>

        <!-- Ringkasan Pembayaran -->
        <div class="bg-white rounded-lg shadow-md p-4 md:p-6 space-y-4">
          <h3 class="text-lg font-semibold text-gray-800">
            Ringkasan Pembayaran
          </h3>
          <div class="flex items-center justify-between">
            <span class="text-gray-600">Total</span>
            <span
              id="order-total"
              class="text-xl font-bold text-primary"
            ></span>
          </div>
        </div>

        <!-- Aksi -->
        <div
          class="flex flex-col md:flex-row items-stretch md:items-center justify-between gap-3"
        >
          <a
            href="index.html"
            class="w-full md:w-auto text-center border border-primary text-primary px-4 py-2 rounded-lg text-sm font-semibold hover:bg-gray-50 transition"
          >
            Ubah Pesanan
          </a>
          <button
            onclick="confirmOrder()"
            class="w-full md:w-auto bg-primary text-white px-4 py-2 rounded-lg text-sm font-semibold hover:bg-opacity-90 transition"
          >
            Bayar
          </button>
        </div>
      </div>
    </main>

    <script>
      function formatRupiah(number) {
        return "Rp " + Number(number).toLocaleString("id-ID");
      }

      function loadOrder() {
        const rawCart = localStorage.getItem("favfood_cart");
        let cart = [];
        if (rawCart) {
          try {
            const parsed = JSON.parse(rawCart);
            if (Array.isArray(parsed)) {
              cart = parsed;
            }
          } catch (e) {
            console.error("Gagal membaca data keranjang", e);
          }
        }

        const emptyState = document.getElementById("empty-state");
        const orderDetail = document.getElementById("order-detail");

        if (!cart.length) {
          emptyState.classList.remove("hidden");
          orderDetail.classList.add("hidden");
          return;
        }

        emptyState.classList.add("hidden");
        orderDetail.classList.remove("hidden");

        const orderItemsEl = document.getElementById("order-items");
        const orderTotalEl = document.getElementById("order-total");
        const orderCountEl = document.getElementById("order-count");

        const totalItems = cart.reduce(
          (sum, item) => sum + (item.quantity || 0),
          0
        );
        const totalPrice = cart.reduce(
          (sum, item) => sum + item.price * (item.quantity || 0),
          0
        );

        orderCountEl.textContent = `${totalItems} item`;
        orderTotalEl.textContent = formatRupiah(totalPrice);

        orderItemsEl.innerHTML = cart
          .map(
            (item) => `
          <div class="py-3 flex items-start justify-between space-x-4">
            <div class="flex items-start space-x-3 flex-1">
              <img
                src="${
                  item.image || "https://via.placeholder.com/80?text=No+Image"
                }"
                alt="${item.name}"
                class="w-16 h-16 sm:w-20 sm:h-20 object-cover rounded-lg flex-shrink-0"
                onerror="this.src='https://via.placeholder.com/80?text=No+Image'"
              />
              <div class="flex-1 min-w-0">
                <p class="font-semibold text-gray-800">${item.name}</p>
                <p class="text-xs text-gray-500 mt-1">
                  ${formatRupiah(item.price)}
                </p>
              </div>
            </div>
            <div class="text-right flex-shrink-0 flex flex-col items-end">
              <p class="font-semibold text-primary">
                ${formatRupiah(item.price * (item.quantity || 0))}
              </p>
              <div class="flex items-center space-x-1 mt-1">
                <button
                  onclick="updateItemQuantity(${item.id}, -1)"
                  class="w-5 h-5 bg-gray-200 rounded flex items-center justify-center hover:bg-gray-300 transition"
                  title="Kurangi jumlah"
                >
                  <i class="fas fa-minus text-[10px]"></i>
                </button>
                <span class="w-6 text-center text-sm font-semibold text-gray-800">${
                  item.quantity || 0
                }</span>
                <button
                  onclick="updateItemQuantity(${item.id}, 1)"
                  class="w-5 h-5 bg-gray-200 rounded flex items-center justify-center hover:bg-gray-300 transition"
                  title="Tambah jumlah"
                >
                  <i class="fas fa-plus text-[10px]"></i>
                </button>
              </div>
            </div>
          </div>
        `
          )
          .join("");
      }

      function updateItemQuantity(itemId, change) {
        const rawCart = localStorage.getItem("favfood_cart");
        if (!rawCart) {
          return;
        }

        let cart = [];
        try {
          const parsed = JSON.parse(rawCart);
          if (Array.isArray(parsed)) {
            cart = parsed;
          }
        } catch (e) {
          console.error("Gagal membaca data keranjang", e);
          return;
        }

        const item = cart.find((i) => i.id === itemId);
        if (!item) {
          return;
        }

        item.quantity = (item.quantity || 0) + change;

        // Jika quantity <= 0, hapus item dari cart
        if (item.quantity <= 0) {
          cart = cart.filter((i) => i.id !== itemId);
        }

        // Simpan kembali ke localStorage
        try {
          localStorage.setItem("favfood_cart", JSON.stringify(cart));
        } catch (e) {
          console.error("Gagal menyimpan data keranjang", e);
          return;
        }

        // Reload order display
        loadOrder();
      }

      function confirmOrder() {
        const rawCart = localStorage.getItem("favfood_cart");
        if (!rawCart) {
          alert("Tidak ada pesanan untuk dikonfirmasi.");
          return;
        }

        let cart = [];
        try {
          const parsed = JSON.parse(rawCart);
          if (Array.isArray(parsed)) {
            cart = parsed;
          }
        } catch (e) {
          console.error(e);
        }

        if (!cart.length) {
          alert("Tidak ada pesanan untuk dikonfirmasi.");
          return;
        }

        // Arahkan ke halaman pembayaran
        window.location.href = "payment.html";
      }

      document.addEventListener("DOMContentLoaded", loadOrder);
    </script>
  </body>
</html>
