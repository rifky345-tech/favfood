<!-- Header Section -->
<div
  class="mb-6 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between"
>
  <div>
    <h2 class="text-2xl sm:text-3xl font-bold text-primary">Manajemen Menu</h2>
    <p class="text-gray-500 mt-1 text-sm sm:text-base">
      Kelola menu makanan dan minuman
    </p>
  </div>
  <button
    onclick="openAddMenuModal()"
    class="bg-primary text-white px-4 py-3 sm:px-6 rounded-lg flex items-center justify-center space-x-2 w-full sm:w-auto"
  >
    <i class="fas fa-plus"></i>
    <span>Tambah Menu</span>
  </button>
</div>

<!-- Stats Cards -->
<div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
  <div class="bg-white rounded-xl shadow-md p-6 border-l-4 border-primary">
    <div class="flex items-center justify-between">
      <div>
        <p class="text-gray-500 text-sm mb-1">Total Menu</p>
        <h3 class="text-2xl font-bold text-gray-800">156</h3>
        <p class="text-green-500 text-sm mt-2">
          <i class="fas fa-arrow-up"></i> 5 menu baru
        </p>
      </div>
      <div class="bg-blue-50 p-4 rounded-lg">
        <i class="fas fa-utensils text-3xl text-primary"></i>
      </div>
    </div>
  </div>

  <div class="bg-white rounded-xl shadow-md p-6 border-l-4 border-green-500">
    <div class="flex items-center justify-between">
      <div>
        <p class="text-gray-500 text-sm mb-1">Menu Aktif</p>
        <h3 class="text-2xl font-bold text-gray-800">142</h3>
        <p class="text-green-500 text-sm mt-2">
          <i class="fas fa-check-circle"></i> Tersedia
        </p>
      </div>
      <div class="bg-green-50 p-4 rounded-lg">
        <i class="fas fa-check-circle text-3xl text-green-500"></i>
      </div>
    </div>
  </div>

  <div class="bg-white rounded-xl shadow-md p-6 border-l-4 border-yellow-500">
    <div class="flex items-center justify-between">
      <div>
        <p class="text-gray-500 text-sm mb-1">Menu Habis</p>
        <h3 class="text-2xl font-bold text-gray-800">8</h3>
        <p class="text-yellow-500 text-sm mt-2">
          <i class="fas fa-exclamation-triangle"></i> Perlu restock
        </p>
      </div>
      <div class="bg-yellow-50 p-4 rounded-lg">
        <i class="fas fa-exclamation-triangle text-3xl text-yellow-500"></i>
      </div>
    </div>
  </div>

  <div class="bg-white rounded-xl shadow-md p-6 border-l-4 border-red-500">
    <div class="flex items-center justify-between">
      <div>
        <p class="text-gray-500 text-sm mb-1">Menu Nonaktif</p>
        <h3 class="text-2xl font-bold text-gray-800">6</h3>
        <p class="text-red-500 text-sm mt-2">
          <i class="fas fa-times-circle"></i> Tidak tersedia
        </p>
      </div>
      <div class="bg-red-50 p-4 rounded-lg">
        <i class="fas fa-times-circle text-3xl text-red-500"></i>
      </div>
    </div>
  </div>
</div>

<!-- Filter and Search Section -->
<div class="bg-white rounded-xl shadow-md p-6 mb-6">
  <div class="flex flex-col md:flex-row gap-4 items-center">
    <div class="flex-1 w-full">
      <div class="relative">
        <i
          class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"
        ></i>
        <input
          type="text"
          id="searchMenu"
          placeholder="Cari menu..."
          class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
          onkeyup="filterMenu()"
        />
      </div>
    </div>
    <div class="md:w-64 w-full">
      <select
        id="filterCategory"
        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
        onchange="filterMenu()"
      >
        <option value="">Semua Kategori</option>
        <option value="makanan">Makanan</option>
        <option value="minuman">Minuman</option>
        <option value="snack">Snack</option>
        <option value="dessert">Dessert</option>
      </select>
    </div>
    <div class="md:w-64 w-full">
      <select
        id="filterStatus"
        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
        onchange="filterMenu()"
      >
        <option value="">Semua Status</option>
        <option value="aktif">Aktif</option>
        <option value="habis">Habis</option>
        <option value="nonaktif">Nonaktif</option>
      </select>
    </div>
  </div>
</div>

<!-- Menu Grid View -->
<div
  id="menuGridView"
  class="grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-3 xl:grid-cols-4 gap-3 sm:gap-4 md:gap-6 mb-6"
></div>

<!-- Menu List View -->
<div id="menuListView" class="hidden">
  <div
    class="bg-white rounded-xl shadow-md overflow-hidden border-l-4 border-primary"
  >
    <div class="p-6 border-b bg-primary">
      <h3 class="text-lg font-semibold text-white">Daftar Menu</h3>
    </div>
    <div class="overflow-x-auto">
      <table class="w-full" id="menuTable">
        <thead class="bg-blue-50">
          <tr>
            <th
              class="px-6 py-3 text-left text-xs font-medium text-primary uppercase"
            >
              Gambar
            </th>
            <th
              class="px-6 py-3 text-left text-xs font-medium text-primary uppercase"
            >
              Nama Menu
            </th>
            <th
              class="px-6 py-3 text-left text-xs font-medium text-primary uppercase"
            >
              Kategori
            </th>
            <th
              class="px-6 py-3 text-left text-xs font-medium text-primary uppercase"
            >
              Harga
            </th>
            <th
              class="px-6 py-3 text-left text-xs font-medium text-primary uppercase"
            >
              Stok
            </th>
            <th
              class="px-6 py-3 text-left text-xs font-medium text-primary uppercase"
            >
              Status
            </th>
            <th
              class="px-6 py-3 text-left text-xs font-medium text-primary uppercase"
            >
              Aksi
            </th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-200" id="menuTableBody"></tbody>
      </table>
    </div>
  </div>
</div>

<!-- Add/Edit Menu Modal -->
<div
  id="menuModal"
  class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50"
  onclick="closeMenuModal(event)"
>
  <div
    class="bg-white rounded-xl shadow-2xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto"
    onclick="event.stopPropagation()"
  >
    <div class="p-6 border-b bg-primary">
      <div class="flex items-center justify-between">
        <h3 class="text-xl font-semibold text-white" id="modalTitle">
          Tambah Menu Baru
        </h3>
        <button
          onclick="closeMenuModal()"
          class="text-white hover:text-gray-200"
        >
          <i class="fas fa-times text-xl"></i>
        </button>
      </div>
    </div>
    <form id="menuForm" class="p-6" onsubmit="saveMenu(event)">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div class="md:col-span-2">
          <label class="block text-sm font-medium text-gray-700 mb-2">
            Gambar Menu
          </label>
          <div class="flex items-center space-x-4">
            <img
              id="menuImagePreview"
              src="https://via.placeholder.com/150"
              alt="Preview"
              class="w-32 h-32 object-cover rounded-lg border border-gray-300"
            />
            <div class="flex-1">
              <input
                type="url"
                id="menuImage"
                placeholder="URL Gambar"
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent mb-2"
                onchange="updateImagePreview()"
              />
              <button
                type="button"
                class="text-sm text-primary hover:underline"
              >
                Upload Gambar
              </button>
            </div>
          </div>
        </div>

        <div class="md:col-span-2">
          <label class="block text-sm font-medium text-gray-700 mb-2">
            Nama Menu <span class="text-red-500">*</span>
          </label>
          <input
            type="text"
            id="menuName"
            required
            placeholder="Contoh: Nasi Goreng Spesial"
            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
          />
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">
            Kategori <span class="text-red-500">*</span>
          </label>
          <select
            id="menuCategory"
            required
            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
          >
            <option value="">Pilih Kategori</option>
            <option value="makanan">Makanan</option>
            <option value="minuman">Minuman</option>
            <option value="snack">Snack</option>
            <option value="dessert">Dessert</option>
          </select>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">
            Harga <span class="text-red-500">*</span>
          </label>
          <div class="relative">
            <span
              class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500"
              >Rp</span
            >
            <input
              type="number"
              id="menuPrice"
              required
              min="0"
              placeholder="0"
              class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
            />
          </div>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">
            Stok <span class="text-red-500">*</span>
          </label>
          <input
            type="number"
            id="menuStock"
            required
            min="0"
            placeholder="0"
            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
          />
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">
            Status <span class="text-red-500">*</span>
          </label>
          <select
            id="menuStatus"
            required
            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
          >
            <option value="aktif">Aktif</option>
            <option value="habis">Habis</option>
            <option value="nonaktif">Nonaktif</option>
          </select>
        </div>

        <div class="md:col-span-2">
          <label class="block text-sm font-medium text-gray-700 mb-2">
            Deskripsi
          </label>
          <textarea
            id="menuDescription"
            rows="3"
            placeholder="Deskripsi menu..."
            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
          ></textarea>
        </div>
      </div>

      <div class="flex justify-end space-x-3 mt-6">
        <button
          type="button"
          onclick="closeMenuModal()"
          class="px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition"
        >
          Batal
        </button>
        <button
          type="submit"
          class="px-6 py-2 bg-primary text-white rounded-lg hover:bg-blue-800 transition"
        >
          Simpan
        </button>
      </div>
    </form>
  </div>
</div>

<script>
  const $ = (id) => document.getElementById(id);
  let currentView = "grid";

  const menuData = [
    { id: 1, name: "Nasi Goreng Spesial", category: "makanan", price: 25000, stock: 45, status: "aktif", image: "https://images.unsplash.com/photo-1565299624946-b28f40a0ae38?w=400&h=250&fit=crop", description: "Nasi goreng dengan telur dan ayam" },
    { id: 2, name: "Es Jeruk Manis", category: "minuman", price: 12000, stock: 78, status: "aktif", image: "https://images.unsplash.com/photo-1544145945-f90425340c7e?w=400&h=250&fit=crop", description: "Minuman segar jeruk peras" },
    { id: 3, name: "Mie Ayam Bakso", category: "makanan", price: 20000, stock: 0, status: "habis", image: "https://images.unsplash.com/photo-1569718212165-3a8278d5f624?w=400&h=250&fit=crop", description: "Mie ayam dengan bakso dan pangsit" },
    { id: 4, name: "Keripik Singkong", category: "snack", price: 8000, stock: 120, status: "aktif", image: "https://images.unsplash.com/photo-1573080496219-bb080dd4f877?w=400&h=250&fit=crop", description: "Keripik singkong original" },
    { id: 5, name: "Es Krim Vanilla", category: "dessert", price: 15000, stock: 32, status: "aktif", image: "https://images.unsplash.com/photo-1551024506-0bccd828d307?w=400&h=250&fit=crop", description: "Es krim vanilla premium" },
    { id: 6, name: "Sate Ayam", category: "makanan", price: 30000, stock: 0, status: "nonaktif", image: "https://images.unsplash.com/photo-1563379091339-03246963d3c9?w=400&h=250&fit=crop", description: "Sate ayam dengan bumbu kacang" }
  ];

  const categoryColors = {
    makanan: "bg-blue-100 text-blue-800",
    minuman: "bg-green-100 text-green-800",
    snack: "bg-purple-100 text-purple-800",
    dessert: "bg-pink-100 text-pink-800"
  };

  const categoryLabels = {
    makanan: "Makanan",
    minuman: "Minuman",
    snack: "Snack",
    dessert: "Dessert"
  };

  function formatPrice(price) {
    return `Rp ${price.toLocaleString("id-ID")}`;
  }

  function renderGridCard(menu) {
    const imgOpacity = menu.status === "habis" ? "opacity-75" : menu.status === "nonaktif" ? "opacity-50" : "";
    const stockColor = menu.stock === 0 ? "text-red-600" : "";
    const statusBadge = menu.status === "habis" ? `<div class="absolute top-2 right-2 sm:top-3 sm:right-3"><span class="px-2 py-0.5 sm:px-3 sm:py-1 text-xs font-semibold bg-yellow-100 text-yellow-800 rounded-full">Habis</span></div>` : "";

    return `
      <div class="bg-white rounded-xl shadow-md overflow-hidden menu-item flex flex-col" data-category="${menu.category}" data-status="${menu.status}" data-id="${menu.id}">
        <div class="relative">
          <img src="${menu.image}" alt="${menu.name}" class="w-full h-40 object-cover ${imgOpacity}" />
          ${statusBadge}
        </div>
        <div class="p-3 sm:p-4 md:p-5 flex flex-col flex-1">
          <div class="flex items-start justify-between mb-2">
            <div class="flex-1">
              <h3 class="text-sm sm:text-base md:text-lg font-bold text-gray-800 mb-1">${menu.name}</h3>
            </div>
          </div>
          <div class="flex items-center justify-start mb-2 sm:mb-3">
            <span class="text-sm sm:text-base md:text-lg font-bold text-primary">${formatPrice(menu.price)}</span>
          </div>
          <div class="flex items-center justify-between mb-2 sm:mb-4">
            <div class="flex items-center text-xs sm:text-sm text-gray-600">
              <i class="fas fa-box mr-1 sm:mr-2"></i>
              <span>Stok: <strong class="${stockColor}">${menu.stock}</strong></span>
            </div>
          </div>
          <div class="flex gap-1 sm:gap-2 mt-auto">
            <button onclick="editMenu(${menu.id})" class="flex-1 bg-primary text-white px-2 py-1.5 sm:px-3 sm:py-2 rounded-lg hover:bg-blue-800 transition text-xs sm:text-sm" title="Edit">
              <i class="fas fa-edit sm:mr-1"></i>
              <span class="hidden sm:inline">Edit</span>
            </button>
            <button onclick="deleteMenu(${menu.id})" class="px-2 py-1.5 sm:px-3 sm:py-2 border border-red-300 text-red-600 rounded-lg hover:bg-red-50 transition text-xs sm:text-sm" title="Hapus">
              <i class="fas fa-trash"></i>
            </button>
          </div>
        </div>
      </div>
    `;
  }

  function renderTableRow(menu) {
    const imgOpacity = menu.status === "nonaktif" ? "opacity-50" : "";
    const statusBadge = menu.status === "habis" ? `<span class="px-3 py-1 text-xs font-semibold bg-yellow-100 text-yellow-800 rounded-full">Habis</span>` : "";

    return `
      <tr class="hover:bg-blue-50 transition menu-item" data-category="${menu.category}" data-status="${menu.status}" data-id="${menu.id}">
        <td class="px-6 py-4">
          <img src="${menu.image.replace("w=400&h=250", "w=100&h=100")}" alt="${menu.name}" class="w-16 h-16 object-cover rounded-lg ${imgOpacity}" />
        </td>
        <td class="px-6 py-4">
          <div class="text-sm font-medium text-gray-800">${menu.name}</div>
          <div class="text-xs text-gray-500">${menu.description}</div>
        </td>
        <td class="px-6 py-4">
          <span class="px-3 py-1 text-xs font-semibold ${categoryColors[menu.category]} rounded-full">${categoryLabels[menu.category]}</span>
        </td>
        <td class="px-6 py-4 text-sm font-semibold text-primary">${formatPrice(menu.price)}</td>
        <td class="px-6 py-4 text-sm text-gray-600">${menu.stock}</td>
        <td class="px-6 py-4">${statusBadge}</td>
        <td class="px-6 py-4 text-sm">
          <button onclick="editMenu(${menu.id})" class="text-primary hover:text-blue-700 mr-3" title="Edit">
            <i class="fas fa-edit"></i>
          </button>
          <button onclick="deleteMenu(${menu.id})" class="text-red-600 hover:text-red-700" title="Hapus">
            <i class="fas fa-trash"></i>
          </button>
        </td>
      </tr>
    `;
  }

  function renderMenus() {
    $("menuGridView").innerHTML = menuData.map(renderGridCard).join("");
    $("menuTableBody").innerHTML = menuData.map(renderTableRow).join("");
  }

  function toggleView(view) {
    currentView = view;
    $("menuGridView").classList.toggle("hidden", view !== "grid");
    $("menuListView").classList.toggle("hidden", view === "grid");
    filterMenu();
  }

  function filterMenu() {
    const search = $("searchMenu").value.toLowerCase();
    const category = $("filterCategory").value;
    const status = $("filterStatus").value;
    const selector = currentView === "grid" ? "h3" : "td:nth-child(2) .text-sm";

    document.querySelectorAll(".menu-item").forEach((item) => {
      const name = item.querySelector(selector)?.textContent.toLowerCase() || "";
      const matches =
        name.includes(search) &&
        (!category || item.dataset.category === category) &&
        (!status || item.dataset.status === status);
      item.style.display = matches ? "" : "none";
    });
  }

  function openModal(mode = "add", id = null) {
    const modal = $("menuModal");
    modal.classList.remove("hidden");
    modal.classList.add("flex");
    $("modalTitle").textContent = mode === "add" ? "Tambah Menu Baru" : "Edit Menu";
    $("menuForm").reset();
    $("menuImagePreview").src = "https://via.placeholder.com/150";
    $("menuForm").setAttribute("data-mode", mode);
    if (id) $("menuForm").setAttribute("data-id", id);
  }

  function openAddMenuModal() {
    openModal("add");
  }

  function closeMenuModal(event) {
    if (!event || event.target.id === "menuModal") {
      $("menuModal").classList.add("hidden");
      $("menuModal").classList.remove("flex");
    }
  }

  function updateImagePreview() {
    const url = $("menuImage").value;
    if (url) $("menuImagePreview").src = url;
  }

  function editMenu(id) {
    openModal("edit", id);
  }

  function deleteMenu(id) {
    if (confirm("Apakah Anda yakin ingin menghapus menu ini?")) {
      alert(`Menu ID: ${id} akan dihapus`);
      const index = menuData.findIndex(m => m.id === id);
      if (index > -1) {
        menuData.splice(index, 1);
        renderMenus();
      }
    }
  }

  function saveMenu(event) {
    event.preventDefault();
    const mode = $("menuForm").getAttribute("data-mode");
    const formData = {
      name: $("menuName").value,
      category: $("menuCategory").value,
      price: $("menuPrice").value,
      stock: $("menuStock").value,
      status: $("menuStatus").value,
      description: $("menuDescription").value,
      image: $("menuImage").value,
    };
    console.log(`${mode} menu:`, formData);
    alert(`Menu berhasil ${mode === "add" ? "ditambahkan" : "diperbarui"}!`);
    closeMenuModal();
  }

  renderMenus();
</script>
